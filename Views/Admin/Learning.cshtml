@model System.Data.DataTable
@{
    ViewBag.Title = "Learning Approval";
    int page = ViewBag.Page;
    int pageSize = ViewBag.PageSize;
    int total = ViewBag.Total;
    int totalPages = (int)Math.Ceiling((double)total / pageSize);
}

<h2>🧠 Learning Approval Dashboard</h2>

<!-- 🔍 SEARCH -->
<form method="get" style="margin-bottom:15px;">
    <input type="text"
           name="search"
           value="@ViewBag.Search"
           placeholder="Search question..."
           style="padding:6px;width:250px;" />
    <button type="submit">🔍 Search</button>
</form>

@if (Model == null || Model.Rows.Count == 0)
{
    <div style="padding:20px;background:#f8f9fa;border:1px dashed #aaa;text-align:center;">
        ✅ No data is present for action.
    </div>
}
else
{
    <table style="width:100%;border-collapse:collapse;background:#fff;">
        <thead style="background:#2c3e50;color:#fff;">
            <tr>
                <th>Question</th>
                <th>Answer</th>
                <th>Asked</th>
                <th>Confidence</th>
                <th>Submitted By</th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
            @foreach (System.Data.DataRow r in Model.Rows)
            {
                <tr style="border-bottom:1px solid #ddd;">
                    <td style="padding:10px;">@r["Question"]</td>

                    <td style="padding:10px;">
                        <form method="post" action="/Admin/Approve">
                            <input type="hidden" name="id" value="@r["Id"]" />

                            <textarea name="newAnswer"
                                      rows="3"
                                      style="width:100%;">@r["UserAnswer"]</textarea>

                            <button style="background:#28a745;color:white;padding:5px 10px;border:none;border-radius:4px;">
                                ✅ Approve
                            </button>
                        </form>

                        <form method="post"
                              action="/Admin/Reject"
                              onsubmit="return confirm('Reject this item?');">
                            <input type="hidden" name="id" value="@r["Id"]" />
                            <button style="background:#dc3545;color:white;padding:5px 10px;border:none;border-radius:4px;margin-top:5px;">
                                ❌ Reject
                            </button>
                        </form>
                    </td>

                    <td style="text-align:center;">@r["AskedCount"]</td>

                    <td style="text-align:center;">
                        @if (r["ConfidenceScore"] != DBNull.Value)
                        {
                            <span style="background:#007bff;color:white;padding:3px 6px;border-radius:6px;">
                                @(Convert.ToDouble(r["ConfidenceScore"]) * 100)%
                            </span>
                        }
                        else
                        {
                            <span style="color:#888;">N/A</span>
                        }
                    </td>

                    <td style="text-align:center;">@r["SubmittedBy"]</td>

                    <td style="text-align:center;color:#ff9800;">
                        Pending
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- 📄 PAGINATION -->
    <div style="margin-top:15px;text-align:center;">
        @for (int i = 1; i <= totalPages; i++)
        {
            if (i == page)
            {
                <strong style="margin:0 5px;">@i</strong>
            }
            else
            {
                <a href="?page=@i&search=@ViewBag.Search"
                   style="margin:0 5px;">@i</a>
            }
        }
    </div>
}
